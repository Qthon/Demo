<!DOCTYPE html>
<html lang="zh_cn">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ÂºïÂÖ•element uiÊ†∑Âºè -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- ÂºïÂÖ•È°µÈù¢CSS -->
    <link rel="stylesheet" href="./style.css">
    <!-- ÂºïÂÖ•echarts.js -->
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.0.1/echarts.common.js"></script>
    <title>üí° - CLOCK</title>
</head>

<body>
    <div id="app" v-cloak>
        <el-row style="height: 65%;">
            <el-col :span=8 style="background-color: #404c53;" class="attendance-time">
                <h3 class="time-title">Êó∂Èó¥({{listLength}})</h3>
                <el-scrollbar style="height: calc(100% - 30px);" tag="ul">
                    <li class="time-item" v-for='(item,index) in list' :key="item.id" @click="show(index)">
                        <p style="width: 70%;" class="listItem"><i :class="item.state"></i>{{item.msg}}</p>
                        <p style="width: 30%;">{{item.time}}</p>
                    </li>
                </el-scrollbar>
            </el-col>
            <el-col :span=8 style="background-color: #2b373d;" class="attendance-tabel">
                <h3 class="tabel-title">21Êó•ÁªüËÆ°</h3>
                <div id="main" style="width: 100%;height:100%;"></div>
            </el-col>
        </el-row>
        <el-row style="height: 35%;">
            <el-col :span=5 style="background-color: #445760;" class="attendance-btn">
                <h3 class="btn-title">Á≠æÂà∞</h3>
                <el-row class="btn">
                    <button @click='handelClick'>Êó©Ëµ∑Á≠æÂà∞ÊâìÂç°</button>
                </el-row>
                <el-row>
                    <div class="msg-show">{{this.showMsg}}</div>
                </el-row>
            </el-col>
        </el-row>
    </div>
    <!-- ÂºïÂÖ•Vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <!-- ÂºïÂÖ•axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- ÂºïÂÖ•moment.js -->
    <script src="./node_modules/moment/moment.js"></script>
    <!-- ÂºïÂÖ•element uiÁªÑ‰ª∂Â∫ì -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script>
        const app = new Vue({
            el: '#app',

            data: {
                list: [],
                listLength: '',
                showMsg: '',
            },

            mounted() {
                // Âä†ËΩΩÂΩ©ËôπÂ±Å
                axios({
                    method: 'get',
                    url: 'https://api.muxiaoguo.cn/api/caihongpi',
                }).then(res => {
                    this.showMsg = res.data.data.comment;
                })
                this.load()
            },

            methods: {
                // ÁÇπÂáªÁ≠æÂà∞
                handelClick() {
                    // Ëé∑ÂèñÂàóË°®Êï∞ÊçÆ
                    axios({
                        method: 'get',
                        url: 'http://127.0.0.1:3000/addData',
                    }).then(res => {
                        this.list = res.data
                        this.load()
                    })
                },

                // Â±ïÁ§∫ÂàóË°®
                show(index) {
                    this.showMsg = this.list[index].msg
                },

                // Âä†ËΩΩÈ°µÈù¢
                load() {
                    // Ëé∑ÂèñÂàóË°®Êï∞ÊçÆ
                    axios({
                        method: 'get',
                        url: 'http://127.0.0.1:3000/getData',
                    }).then(res => {
                        this.list = res.data
                        this.listLength = res.data.length
                    })
                    this.getTimeList()
                },

                // Âä†ËΩΩÂõæË°®
                async getTimeList() {
                    // ÂèëÈÄÅËØ∑Ê±ÇËé∑ÂèñÂõæË°®ÊâÄÈúÄÁöÑÊï∞ÊçÆ
                    // Âü∫‰∫éÂáÜÂ§áÂ•ΩÁöÑdomÔºåÂàùÂßãÂåñechartsÂÆû‰æã
                    var myChart = echarts.init(document.getElementById('main'));
                    let timeList = []

                    await axios({
                        method: 'get',
                        url: 'http://127.0.0.1:3000/getData',
                    }).then(res => {
                        const arr = res.data
                        arr.forEach(item => {
                            timeList.push(moment(item.id).format('HH:mm'))
                        });
                    })

                    var option = {
                        tooltip: {
                            trigger: 'axis'
                        },
                        grid: {
                            width: 'auto',
                            height: 'auto',
                            right: '0px',
                            left: '5%',
                            bottom: '15%'
                        },
                        xAxis: {
                            type: 'category',
                            data: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21'],
                        },
                        yAxis: {
                            type: 'category',
                            show: true,
                            // data: ['6:00', '9:00', '12:00', '15:00', '18:00', '21:00', '24:00'],
                            splitLine: {
                                lineStyle: {
                                    // ‰ΩøÁî®Ê∑±ÊµÖÁöÑÈó¥ÈöîËâ≤
                                    color: ['#555']
                                }
                            },
                        },
                        series: [{
                            data: timeList,
                            type: 'line',
                            lineStyle: {
                                color: "#528281"
                            },
                            smooth: true,
                        }]
                    };

                    // ‰ΩøÁî®ÂàöÊåáÂÆöÁöÑÈÖçÁΩÆÈ°πÂíåÊï∞ÊçÆÊòæÁ§∫ÂõæË°®„ÄÇ
                    myChart.setOption(option);
                }
            }
        }) 
    </script>
</body>

</html>