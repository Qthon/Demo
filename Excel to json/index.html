<!DOCTYPE html>
<html lang="zh_cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excelè½¬ JSON</title>
    <script src="./node_modules/jquery/dist/jquery.js"></script>
    <style>
        .box-main {
            display: flex;
            justify-content: space-between;
        }
        
        .box-main .base {
            height: 95vh;
            background-color: #fafafa;
            padding: 20px;
            width: 29.5%;
            border-radius: 10px;
            border: 1px #333333 dashed;
            box-sizing: border-box;
            overflow: auto;
        }
        
        #jsonObject {
            box-sizing: border-box;
            padding: 20px;
            background-color: #282c34;
            width: 70%;
            font-size: 14px;
            color: #fff;
            height: 95vh;
            border-radius: 10px;
            overflow: auto;
            letter-spacing: .2em;
        }
        
        input[type="file"] {
            outline: none;
            cursor: pointer;
        }
        
        .box-result {
            position: relative;
        }
        
        .box-result button {
            position: absolute;
            cursor: pointer;
            color: #fff;
            right: 20px;
            letter-spacing: normal;
            top: 10px;
            background-color: #222222;
            padding: 8px 15px;
            border: none;
            outline: none;
            border-radius: 3px;
        }
    </style>
</head>

<body>
    <div class="box-main">
        <div class="base">
            <h3 style="text-align: center;color: #282c34;">Excelè½¬Jsonç”¨å‰é¡»çŸ¥</h3>
            <p>ä¸ºäº†è¯»å–çš„æ­£ç¡®æ€§ï¼Œå»ºè®®Excelè¡¨æ ¼æ•°æ®æ ¼å¼ä¸ºä»¥ä¸‹å½¢å¼ğŸ‘‡ğŸ‘‡ğŸ‘‡</p>
            <img src="./images/demo1.png" alt="Excelè¡¨æ ¼æ ¼å¼è§„èŒƒ" style="width: 80%;">
            <!-- é€‰æ‹©excelæ–‡ä»¶çš„inputæ–‡ä»¶è¡¨å•,æ­¤è¡¨å•é™åˆ¶é€‰æ‹©excelæ–‡ä»¶ -->
            <h3 style="text-align: center;color: #282c34;">å¼€å§‹ä½¿ç”¨</h3>
            <p>ä¸Šä¼ éœ€è¦è½¬æ¢çš„Excelè¡¨æ ¼ï¼Œé€‰æ‹©å¹¶å›è½¦ï¼Œå³ä¾§å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ ğŸ‘‰</p>
            <input type="file" id="fileUploader" name="fileUploader" accept=".xls, .xlsx" onchange="fileClick(event)" />
        </div>
        <div id="jsonObject"></div>
        <div class="box-result">
            <button onclick="copycontent()">Copy</button>
        </div>
    </div>
    <script src="./node_modules/xlsx/dist/xlsx.full.min.js"></script>
    <script src="./node_modules/xlsx/dist/xlsx.core.min.js"></script>
    <script>
        // è¯»å–æ–‡ä»¶æ•°æ®
        function fileClick(evt) {
            // å‡è®¾ç”¨æˆ·åªä¸Šä¼ ä¸€ä¸ªè¡¨æ ¼
            var selectedFile = evt.target.files[0];
            // FileReader è¯»å–æ–‡ä»¶æ•°æ®
            var reader = new FileReader();
            // è¯»å–æˆåŠŸå¤„ç†
            reader.onload = function(event) {
                var data = event.target.result;
                var workbook = XLSX.read(data, {
                    type: 'binary'
                });
                workbook.SheetNames.forEach(function(sheetName) {
                    var XL_row_object = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
                    if (XL_row_object.length > 0) {
                        document.getElementById("jsonObject").innerHTML = formatJson(JSON.stringify(XL_row_object));
                    }
                })
            };
            // è¯»å–å¤±è´¥å¤„ç†
            reader.onerror = function(event) {
                console.error("File could not be read! Code " + event.target.error.code);
            };
            // è¯»å–ä¸Šä¼ æ–‡ä»¶ä¸ºäºŒè¿›åˆ¶
            reader.readAsBinaryString(selectedFile);
        };

        // JSONæ ¼å¼åŒ–
        function formatJson(v, options) {
            v = v.replace(/&quot;/g, '"');
            v = v.replace(/ /g, '');
            var reg = /(\[|{|,)/g;
            v = v.replace(reg, function(a, b) {
                return a + "<br/>";
            });
            reg = /(}|\])/g;
            v = v.replace(reg, function(a, b) {
                return "<br/>" + a;
            });
            reg = /(:\[)/g;
            v = v.replace(reg, function(a, b) {
                return a[0] + "<br/>" + a[1];
            });
            var arr = v.toString().split("<br/>")
            var arr1 = new Array("[", "]");
            var arr2 = new Array("{", "}");
            var pre = "";
            v = "";
            var chr = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
            var lth = chr.length;
            var prev = "";
            $.each(arr, function(index, item) {
                if (item == "[" || item == "{") {
                    if (pre != "},") {
                        prev += chr;
                    }
                    v += prev + item + "<br />";
                } else if (item == "]" || item == "}" || item == "},") {
                    prev = prev.substr(0, prev.length - lth);
                    v += prev + item + "<br />";
                } else {
                    if (pre == "{") {
                        prev += chr;
                    }
                    v += prev + item + "<br />";
                }
                pre = item;
            });
            var reg = /(&nbsp;".\w+")/g;
            // è¾“å‡º
            v = v.replace(reg, function(a, b) {
                return "<span style=\"color:#e36437;\">" + a + "</span>";
            });
            reg = /((:\s*\"([^\"]*)\"(,?))|(:\s*(\d+(\.\d)*|null)+[,]?))/g;
            v = v.replace(reg, function(a, b) {
                return "<span style=\"color:#62c699;\">" + a + "</span>";
            });
            return v;
        };

        function copycontent() {
            // è·å–å†…å®¹ ï¼ˆå»é™¤å­—ç¬¦ä¸²ä¸­æ‰€æœ‰çš„ç©ºæ ¼ï¼‰
            var data = $('#jsonObject').text().replace(/\s+/g, "");
            // å¤åˆ¶
            copyToClip(data)
        }

        function copyToClip(content) {
            // åˆ›å»ºinputèŠ‚ç‚¹
            var aux = document.createElement("input");
            // è®¾ç½®inputå€¼ = éœ€è¦å¤åˆ¶çš„å†…å®¹
            aux.setAttribute("value", content);
            // åœ¨bodyä¸­æ’å…¥inputèŠ‚ç‚¹
            document.body.appendChild(aux);
            // é€‰ä¸­
            aux.select();
            // å› ä¸ºexecComand()å¤åˆ¶çš„æ–¹æ³•åªèƒ½åœ¨inputä¸­ä½¿ç”¨ï¼Œå› æ­¤å¯¹äºå…¶ä»–æ ‡ç­¾å¦‚div ã€ spanå°±æ˜¯åˆ©ç”¨æ’å…¥ä¸€ä¸ªinputèŠ‚ç‚¹æ¥æ¥æ”¶spanã€divé‡Œçš„å†…å®¹æ¥è¾¾åˆ°å¤åˆ¶çš„æ•ˆæœ
            document.execCommand("copy");
            // åˆ é™¤inputèŠ‚ç‚¹
            document.body.removeChild(aux);
            alert('å¤åˆ¶æˆåŠŸ');
        }
    </script>
</body>

</html>